(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tushujieyue/add-or-update"],{"5a13":function(e,t,i){"use strict";(function(e){i("6cdc"),i("921b");r(i("66fd"));var t=r(i("b055"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},"63fa":function(e,t,i){"use strict";var r,n=function(){var e=this,t=e.$createElement;e._self._c},u=[];i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return u})),i.d(t,"a",(function(){return r}))},"74dc":function(e,t,i){},9440:function(e,t,i){"use strict";var r=i("74dc"),n=i.n(r);n.a},b055:function(e,t,i){"use strict";i.r(t);var r=i("63fa"),n=i("c10f");for(var u in n)"default"!==u&&function(e){i.d(t,e,(function(){return n[e]}))}(u);i("9440");var a,s=i("f0c5"),o=Object(s["a"])(n["default"],r["b"],r["c"],!1,null,"541e8fdf",null,!1,r["a"],a);t["default"]=o.exports},c10f:function(e,t,i){"use strict";i.r(t);var r=i("f394"),n=i.n(r);for(var u in r)"default"!==u&&function(e){i.d(t,e,(function(){return r[e]}))}(u);t["default"]=n.a},f394:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(i("a34a"));function n(e){return e&&e.__esModule?e:{default:e}}function u(e,t,i,r,n,u,a){try{var s=e[u](a),o=s.value}catch(h){return void i(h)}s.done?t(o):Promise.resolve(o).then(r,n)}function a(e){return function(){var t=this,i=arguments;return new Promise((function(r,n){var a=e.apply(t,i);function s(e){u(a,r,n,s,o,"next",e)}function o(e){u(a,r,n,s,o,"throw",e)}s(void 0)}))}}var s=function(){return Promise.all([i.e("common/vendor"),i.e("components/w-picker/w-picker")]).then(i.bind(null,"e2b1"))},o=function(){return i.e("components/xia-editor/xia-editor").then(i.bind(null,"064f"))},h={data:function(){return{cross:"",ruleForm:{jieyuebianhao:this.getUUID(),tushubianhao:"",tushumingcheng:"",shuliang:"",meirifeiyong:"",jieyuetianshu:"",yajin:"",jine:"",jiechushijian:"",jieyuezhanghao:"",jieyuejine:"",chujiezhanghao:""},user:{},ro:{jieyuebianhao:!1,tushubianhao:!1,tushumingcheng:!1,shuliang:!1,meirifeiyong:!1,jieyuetianshu:!1,yajin:!1,jine:!1,jiechushijian:!1,jieyuezhanghao:!1,jieyuejine:!1,chujiezhanghao:!1}}},components:{wPicker:s,xiaEditor:o},computed:{baseUrl:function(){return this.$base.url},jine:{get:function(){return 1*this.ruleForm.shuliang*this.ruleForm.meirifeiyong*this.ruleForm.jieyuetianshu+parseFloat(this.ruleForm.yajin)}}},onLoad:function(){var t=a(r.default.mark((function t(i){var n,u,a,s;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.ruleForm.jiechushijian=this.$utils.getCurDate(),n=e.getStorageSync("nowTable"),t.next=4,this.$api.session(n);case 4:if(u=t.sent,this.user=u.data,this.ruleForm.jieyuezhanghao=this.user.jieyuezhanghao,this.ro.jieyuezhanghao=!0,this.ruleForm.jieyuejine=this.user.jine,this.ro.jieyuejine=!0,this.ruleForm.userid=e.getStorageSync("userid"),i.refid&&(this.ruleForm.refid=i.refid,this.ruleForm.nickname=e.getStorageSync("nickname")),!i.id){t.next=18;break}return this.ruleForm.id=i.id,t.next=16,this.$api.info("tushujieyue",this.ruleForm.id);case 16:u=t.sent,this.ruleForm=u.data;case 18:if(this.cross=i.cross,!i.cross){t.next=76;break}a=e.getStorageSync("crossObj"),t.t0=r.default.keys(a);case 22:if((t.t1=t.t0()).done){t.next=74;break}if(s=t.t1.value,"jieyuebianhao"!=s){t.next=28;break}return this.ruleForm.jieyuebianhao=a[s],this.ro.jieyuebianhao=!0,t.abrupt("continue",22);case 28:if("tushubianhao"!=s){t.next=32;break}return this.ruleForm.tushubianhao=a[s],this.ro.tushubianhao=!0,t.abrupt("continue",22);case 32:if("tushumingcheng"!=s){t.next=36;break}return this.ruleForm.tushumingcheng=a[s],this.ro.tushumingcheng=!0,t.abrupt("continue",22);case 36:if("shuliang"!=s){t.next=40;break}return this.ruleForm.shuliang=a[s],this.ro.shuliang=!0,t.abrupt("continue",22);case 40:if("meirifeiyong"!=s){t.next=44;break}return this.ruleForm.meirifeiyong=a[s],this.ro.meirifeiyong=!0,t.abrupt("continue",22);case 44:if("jieyuetianshu"!=s){t.next=48;break}return this.ruleForm.jieyuetianshu=a[s],this.ro.jieyuetianshu=!0,t.abrupt("continue",22);case 48:if("yajin"!=s){t.next=52;break}return this.ruleForm.yajin=a[s],this.ro.yajin=!0,t.abrupt("continue",22);case 52:if("jine"!=s){t.next=56;break}return this.ruleForm.jine=a[s],this.ro.jine=!0,t.abrupt("continue",22);case 56:if("jiechushijian"!=s){t.next=60;break}return this.ruleForm.jiechushijian=a[s],this.ro.jiechushijian=!0,t.abrupt("continue",22);case 60:if("jieyuezhanghao"!=s){t.next=64;break}return this.ruleForm.jieyuezhanghao=a[s],this.ro.jieyuezhanghao=!0,t.abrupt("continue",22);case 64:if("jieyuejine"!=s){t.next=68;break}return this.ruleForm.jieyuejine=a[s],this.ro.jieyuejine=!0,t.abrupt("continue",22);case 68:if("chujiezhanghao"!=s){t.next=72;break}return this.ruleForm.chujiezhanghao=a[s],this.ro.chujiezhanghao=!0,t.abrupt("continue",22);case 72:t.next=22;break;case 74:this.ruleForm.shuliang=0,this.ro.shuliang=!1;case 76:this.styleChange();case 77:case"end":return t.stop()}}),t,this)})));function i(e){return t.apply(this,arguments)}return i}(),methods:{styleChange:function(){this.$nextTick((function(){}))},jiechushijianChange:function(e){this.ruleForm.jiechushijian=e.target.value,this.$forceUpdate()},getUUID:function(){return(new Date).getTime()},onSubmitTap:function(){var t=a(r.default.mark((function t(){var i,n,u,a,s,o,h,c,l,f;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.ruleForm.jine=this.jine,i=e.getStorageSync("crossObj"),n=e.getStorageSync("crossTable"),!(parseFloat(i.shuliang)-parseFloat(this.ruleForm.shuliang)<0)){t.next=6;break}return this.$utils.msg("数量不足"),t.abrupt("return");case 6:if(this.ruleForm.shuliang){t.next=9;break}return this.$utils.msg("数量不能为空"),t.abrupt("return");case 9:if(!this.ruleForm.shuliang||this.$validate.isIntNumer(this.ruleForm.shuliang)){t.next=12;break}return this.$utils.msg("数量应输入整数"),t.abrupt("return");case 12:if(this.ruleForm.meirifeiyong){t.next=15;break}return this.$utils.msg("每日费用不能为空"),t.abrupt("return");case 15:if(!this.ruleForm.meirifeiyong||this.$validate.isIntNumer(this.ruleForm.meirifeiyong)){t.next=18;break}return this.$utils.msg("每日费用应输入整数"),t.abrupt("return");case 18:if(this.ruleForm.jieyuetianshu){t.next=21;break}return this.$utils.msg("借阅天数不能为空"),t.abrupt("return");case 21:if(!this.ruleForm.jieyuetianshu||this.$validate.isIntNumer(this.ruleForm.jieyuetianshu)){t.next=24;break}return this.$utils.msg("借阅天数应输入整数"),t.abrupt("return");case 24:if(this.ruleForm.yajin){t.next=27;break}return this.$utils.msg("押金不能为空"),t.abrupt("return");case 27:if(!this.ruleForm.yajin||this.$validate.isIntNumer(this.ruleForm.yajin)){t.next=30;break}return this.$utils.msg("押金应输入整数"),t.abrupt("return");case 30:if(!this.ruleForm.jine||this.$validate.isIntNumer(this.ruleForm.jine)){t.next=33;break}return this.$utils.msg("金额应输入整数"),t.abrupt("return");case 33:if(!this.cross){t.next=49;break}if(o=e.getStorageSync("statusColumnName"),h=e.getStorageSync("statusColumnValue"),""==o){t.next=49;break}if(i||(i=e.getStorageSync("crossObj")),o.startsWith("[")){t.next=45;break}for(c in i)c==o&&(i[c]=h);return n=e.getStorageSync("crossTable"),t.next=43,this.$api.update("".concat(n),i);case 43:t.next=49;break;case 45:u=Number(e.getStorageSync("userid")),a=i["id"],s=e.getStorageSync("statusColumnName"),s=s.replace(/\[/,"").replace(/\]/,"");case 49:if(!a||!u){t.next=80;break}return this.ruleForm.crossuserid=u,this.ruleForm.crossrefid=a,l={page:1,limit:10,crossuserid:u,crossrefid:a},t.next=55,this.$api.list("tushujieyue",l);case 55:if(f=t.sent,!(f.data.total>=s)){t.next=61;break}return this.$utils.msg(e.getStorageSync("tips")),t.abrupt("return",!1);case 61:return i||(i=e.getStorageSync("crossObj")),n=e.getStorageSync("crossTable"),i.shuliang=parseFloat(i.shuliang)-parseFloat(this.ruleForm.shuliang),t.next=66,this.$api.update("".concat(n),i);case 66:if(!this.ruleForm.id){t.next=71;break}return t.next=69,this.$api.update("tushujieyue",this.ruleForm);case 69:t.next=77;break;case 71:return t.next=73,this.$api.add("tushujieyue",this.ruleForm);case 73:if(!this.user.jine){t.next=77;break}return this.user.jine=parseFloat(this.user.jine)-parseFloat(this.ruleForm.jine),t.next=77,this.$api.update(e.getStorageSync("nowTable"),this.user);case 77:this.$utils.msgBack("提交成功");case 78:t.next=97;break;case 80:return i||(i=e.getStorageSync("crossObj")),n=e.getStorageSync("crossTable"),i.shuliang=i.shuliang-this.ruleForm.shuliang,t.next=85,this.$api.update("".concat(n),i);case 85:if(!this.ruleForm.id){t.next=90;break}return t.next=88,this.$api.update("tushujieyue",this.ruleForm);case 88:t.next=96;break;case 90:return t.next=92,this.$api.add("tushujieyue",this.ruleForm);case 92:if(!this.user.jine){t.next=96;break}return this.user.jine=parseFloat(this.user.jine)-parseFloat(this.ruleForm.jine),t.next=96,this.$api.update(e.getStorageSync("nowTable"),this.user);case 96:this.$utils.msgBack("提交成功");case 97:case"end":return t.stop()}}),t,this)})));function i(){return t.apply(this,arguments)}return i}(),optionsChange:function(e){this.index=e.target.value},bindDateChange:function(e){this.date=e.target.value},getDate:function(e){var t=new Date,i=t.getFullYear(),r=t.getMonth()+1,n=t.getDate();return"start"===e?i-=60:"end"===e&&(i+=2),r=r>9?r:"0"+r,n=n>9?n:"0"+n,"".concat(i,"-").concat(r,"-").concat(n)},toggleTab:function(e){this.$refs[e].show()}}};t.default=h}).call(this,i("543d")["default"])}},[["5a13","common/runtime","common/vendor"]]]);